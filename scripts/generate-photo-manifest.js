import fs from 'fs';
import path from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

function getPhotosFromFolder(folderPath) {
  const fullPath = path.join(__dirname, '..', 'public', folderPath);
  if (!fs.existsSync(fullPath)) {
    return [];
  }
  
  const files = fs.readdirSync(fullPath)
    .filter(file => file.endsWith('.webp'))
    .map(file => `/${folderPath}/${file}`)
    .sort((a, b) => {
      // Extract numbers from filenames for natural sorting
      const numA = parseInt(a.match(/\d+/)?.[0] || '0');
      const numB = parseInt(b.match(/\d+/)?.[0] || '0');
      if (numA !== numB) return numA - numB;
      // If numbers are equal, sort alphabetically
      return a.localeCompare(b);
    });
  
  return files;
}

const cameraRollPhotos = getPhotosFromFolder('assets/photosapp/cameraroll');
const photoLibraryPhotos = getPhotosFromFolder('assets/photosapp/photolibrary');

const manifest = {
  cameraRoll: cameraRollPhotos,
  photoLibrary: photoLibraryPhotos
};

// Write JSON manifest
const jsonOutputPath = path.join(__dirname, '..', 'public', 'assets', 'photosapp', 'photo-manifest.json');
fs.writeFileSync(jsonOutputPath, JSON.stringify(manifest, null, 2));

// Write TypeScript file for synchronous imports
const tsOutputPath = path.join(__dirname, '..', 'src', 'components', 'Iphone', 'photoManifest.ts');
const tsContent = `// This file is auto-generated by scripts/generate-photo-manifest.js
// Run: node scripts/generate-photo-manifest.js to regenerate after adding photos

export const CAMERA_ROLL_PHOTOS: string[] = ${JSON.stringify(cameraRollPhotos, null, 2)};

export const PHOTO_LIBRARY_PHOTOS: string[] = ${JSON.stringify(photoLibraryPhotos, null, 2)};
`;
fs.writeFileSync(tsOutputPath, tsContent);

console.log('Photo manifest generated successfully!');
console.log(`Camera Roll: ${cameraRollPhotos.length} photos`);
console.log(`Photo Library: ${photoLibraryPhotos.length} photos`);
